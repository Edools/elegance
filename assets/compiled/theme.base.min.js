"use strict";!function(){window.app={bindGlobal:function(){FastClick.attach(document.body),$(".timeago").timeago(),$(document).trigger("app:bind:global")},bindOpenOnLoad:function(){var e=$(".js-open-on-load");e.length>0&&$.each(e,function(e,t){window.open($(t).attr("href"))}),$(document).trigger("app:bind:open_on_load")},bindTooltips:function(){$("[data-toggle='tooltip']").tooltip("destroy").tooltip(),$(document).trigger("app:bind:tooltips")},checkFormValidity:function(e){var t=e.currentTarget,n=$(t).find('button[type="submit"]');t.checkValidity()?n.removeAttr("disabled"):n.attr("disabled","disabled"),$(document).trigger("app:bind:check_form_validity")},init:function(){app.pagarme.init(),app.bindGlobal(),app.bindBlazy(),app.bindOpenOnLoad(),app.bindMasks(),app.bindTooltips(),app.bindReadMore(),app.bindDatepicker(),app.bindFixOnScroll(),app.ckeditor.bindCkeditor(),app.bindCheckout(),app.lessonList.init(),app.chat.init(),app.studentDoubts.init(),app.notepad.init(),app.categoryList.init(),app.bindExamQuestionForm(),app.changeTimeZone(),app.followBind(),app.lessonPage(),app.bindPostsForm(),$(document).on("app:bind:ckeditor_submit",app.bindCollaborativeDiscussion)}}}(),function(){app.bindBlazy=function(e){new Blazy,$(document).trigger("app:bind:blazy")}}(),function(){app.categoryList={init:function(){var e=this;e.$categoryList=$("#js-category-list"),0!=e.$categoryList.length&&(e.isActive=e.$categoryList.data("is-active")||e.isActive,e.isActive||(e.bindClicks(),e.$categoryList.attr("data-is-active",!0),e.isActive=!0),e.expandParents())},bindClicks:function(){var e=this;$(document).on("click","#js-category-list .category-item .toggle-btn",function(){e.expandParent($(this).parent(".category-item"),!0)})},expandParent:function(e,t){var n=e.find(".list-group").first(),a=e;t?n.stop().slideToggle("fast"):n.stop().toggle(),a.toggleClass("expanded")},expandParents:function(){for(var e=this,t=e.$categoryList.find(".category-item.current").first();t;){e.expandParent(t,!1);var n=t.parents(".category-item").first();t=n.length>0?n:null}}}}(),function(){app.chat={init:function(){if(this.$jsChat=$(".js-chat"),this.$text=$(".js-chat-text"),this.$messagesContainer=$(".js-chat-messages .js-content"),this.apiKey=$("#js-chat-page").data("api-key"),this.userId=$("#js-chat-page").data("user-id"),!(this.$jsChat.length<=0)){var e=this;e.bindScroll(),e.$messagesContainer.empty(),e.$text.keyup(function(t){var n=t.keyCode?t.keyCode:t.which;13!=n||t.shiftKey||e.submitMessage(t)}),app.simpleEditor.init("#js-send-messages"),$("#js-send-messages").on("submit",e.submitMessage);var t={apiKey:"AIzaSyD2oUy-240XWPEWmGrh6PqJRaoA4lJFN4s",authDomain:"edools-chat.firebaseapp.com",databaseURL:"https://edools-chat.firebaseio.com",projectId:"edools-chat",storageBucket:"edools-chat.appspot.com",messagingSenderId:"322321995609"};firebase.initializeApp(t),this.database=firebase.database(),this.authenticate(),e.loadGroups(e.didLoadGroups),e.loadGeneral(e.didLoadGeneral),e.loadFollowers(e.didLoadFollowers)}},authenticate:function(e){var t=app.chat;$.ajax({url:"https://6qkqv5t2k9.execute-api.us-east-1.amazonaws.com/staging/authenticate",method:"POST",headers:{Authorization:"Token token=e93921df82b231b2873e94cefb0ea8de:d0fa24e82abd334da092a39eef0d6101"}}).success(function(e){firebase.auth().signInWithCustomToken(e.body.firebase_token).then(function(e){console.log("authenticated"),t.monitorConnectionState(e)})["catch"](function(e){console.log("Error creating custom token:",e)})}).error(function(e){console.log("could not authenticate"),console.log(e)})},monitorConnectionState:function(e){var t=(app.chat,firebase.database().ref("user_status/"+e.uid));firebase.database().ref(".info/connected").on("value",function(e){e.val()&&(t.onDisconnect().set("offline"),t.set("online"))}),document.onIdle=function(){t.set("idle")},document.onAway=function(){t.set("away")},document.onBack=function(e,n){t.set("online")}},bindScroll:function(){this.$jsChat.data("height");this.chatHeight=.8*$(window).height(),this.$messagesScrollContainer=this.$jsChat.find(".chat-messages .js-scroll-container"),this.$messagesScroll=this.$messagesScrollContainer.find(".js-scroll");var e=this.$jsChat.find(".chat-messages .header"),t=this.$jsChat.find(".chat-messages .editor"),n=this.chatHeight-42-(e.height()+t.height());this.$jsChat.height(this.chatHeight),this.$messagesScrollContainer.height(n),this.$jsChat.find(".js-sidebar-scroll").scrollbar({}),this.$messagesScroll.scrollbar({})},loadMessages:function(){var e=app.chat,t=function(t){e.insertMessage(t.val())}.bind(e);e.messages.limitToLast(12).on("child_added",t),e.messages.limitToLast(12).on("child_changed",t)},sanitizeHtml:function(e){return e.find("div:empty").remove(),e.children().each(function(e,t){var n=$(t);"BR"!=t.tagName&&n.find("br").length>0&&n.find("br").length==n.children().length&&n.remove()}),"BR"==e.last().get(0).tagName&&e.last().remove(),e},submitMessage:function(e){function t(e){return e<10?"0"+e:e}e.preventDefault();var n=app.chat,a=n.sanitizeHtml(n.$text),o=a.html();if(!(o.length<=0)){n.$text.html("").focus();var s=new Date,i=$("#school-header").first().data("user");n.messages.push({id:i.id,name:i.name,avatar_url:i.avatar_url,text:o,timestamp:moment().unix(),schedule:t(s.getHours())+":"+t(s.getMinutes())})}},insertMessage:function(e){var t=app.chat,n=t.renderTemplate("chat-message",{avatar:e.avatar_url,name:e.name,text:e.text,schedule:moment.unix(e.timestamp).format("LLL")});t.$messagesContainer.append(n),t.$messagesScroll.scrollTop(t.$messagesScroll[0].scrollHeight)},renderTemplate:function(e,t){var n=$("#"+e+"-template").html(),a=Liquid.parse(n);return a.render(t)},loadGroups:function(e){var t=app.chat;$.ajax({url:window.CORE_HOST+"/chat/groups",method:"GET",headers:{Authorization:"Token token="+t.apiKey}}).success(function(t){e(t)})},loadGeneral:function(e){var t=app.chat;$.ajax({url:window.CORE_HOST+"/chat/general",method:"GET",headers:{Authorization:"Token token="+t.apiKey}}).success(function(t){e(t)})},loadFollowers:function(e){var t=app.chat;$.ajax({url:window.CORE_HOST+"/chat/followers",method:"GET",headers:{Authorization:"Token token="+t.apiKey}}).success(function(t){e(t)})},didLoadGroups:function(e){var t=app.chat;e.forEach(function(e){var n=$(t.renderTemplate("chat-group-list-item",e));n.on("click",app.chat.changeRoom),$(".js-groups").append(n)}),t.selectFirstRoomAvailable()},didLoadGeneral:function(e){var t=app.chat;t.addProfileItems(e,"js-team"),t.selectFirstRoomAvailable()},didLoadFollowers:function(e){var t=app.chat;t.addProfileItems(e,"js-students"),t.selectFirstRoomAvailable()},addProfileItems:function(e,t){var n=app.chat;e.forEach(function(e){var a=$(n.renderTemplate("chat-profile-list-item",e));a.on("click",app.chat.changeRoom),$("."+t).append(a)})},changeRoom:function(e){var t=app.chat,n=$(e.currentTarget);$(".chat-sidebar-list-item").removeClass("active"),n.addClass("active");var a="messages";if("products"===n.data("type"))a+="_products/"+n.data("id"),$("#js-room-title").html($("#js-chat-group-name",n).html()),$("#js-room-users-count").html($("#js-chat-group-users-count",n).html());else if("users"===n.data("type")){var o=[t.userId,parseInt(n.data("id"))].sort();a+="_users/"+o[0]+"/"+o[1],$("#js-room-title").html($(".info .name",n).html()),$("#js-room-users-count").html($(".info .location",n).html())}t.$messagesContainer.html(""),t.messages=t.database.ref(a),t.loadMessages()},selectFirstRoomAvailable:function(){self.$selectedRoom||(self.$selectedRoom=$(".chat-sidebar-list-item").first(),self.$selectedRoom.click())}}}(),function(){app.bindCheckout=function(){$("#js-terms-of-use-check").change(function(){$(this).is(":checked")===!0?$(".cta-checkout-cart").removeClass("disabled"):$(".cta-checkout-cart").addClass("disabled")}),$(document).trigger("app:bind:checkout")}}(),function(){app.ckeditor={bindCkeditor:function(){var e="//cdn.edools.com/libs/ckeditor/4.5.10/ckeditor.js";$(".js-ckeditor").length&&loadAsset("window.CKEDITOR",e,function(){var e={language:"pt-br",skin:"bootstrapck"};$(".js-ckeditor").each(function(t,n){$("#cke_"+n.id).length||(e.placeholder=n.placeholder,CKEDITOR.replace(n.id,e))}),app.ckeditor.bindCkeditorSubmit(),$(document).trigger("app:bind:ckeditor")})},bindCkeditorSubmit:function(){$.each($(".js-ckeditor"),function(e,t){var n=$(t),a=n.parents("form"),o=n.attr("id");if(a){var s=a.find('button[type="submit"]');CKEDITOR.instances[o].on("change",function(){this.getData().length?s.attr("disabled",!1):s.attr("disabled",!0)})}}),$(document).trigger("app:bind:ckeditor_submit")}}}(),function(){app.bindCollaborativeDiscussion=function(){$(document).on("click","#collaborative-discussion .js-edit-button",function(){var e=$(this).data("comment-id"),t=$("#js-comment-"+e);t.find(".js-show-comment").addClass("hide"),t.find(".js-edit-container").removeClass("hide")}),$(document).on("click","#collaborative-discussion .js-cancel-button",function(){var e=$(this).data("comment-id"),t=$("#js-comment-"+e);t.find(".js-show-comment").removeClass("hide"),t.find(".js-edit-container").addClass("hide")}),$(document).trigger("app:bind:collaborative_discussion")}}(),function(){app.bindDatepicker=function(){$.fn.datepicker.defaults.language="pt-BR",$(".datepicker").each(function(e,t){var n=$(t),a=$('<input type="hidden" />').insertBefore(n.parent()),o=moment(n.val()).utc().format("DD/MM/YYYY"),s=moment(n.val()).utc().format("YYYY-MM-DD");s="Invalid date"===s?null:s,a.attr("id",n.attr("id")),a.attr("name",n.attr("name")),a.attr("value",s),n.removeAttr("id"),n.removeAttr("name"),""!==n.val()&&n.val(o),$(t).datepicker().on("change",function(){var e=moment(n.val(),"DD/MM/YYYY").utc().format("YYYY-MM-DD");e="Invalid date"===e?null:e,a.val(e)})}),$(document).trigger("app:bind:datepicker")}}(),function(){app.bindExamQuestionForm=function(){$(document).on("click","#js-remake-exam",function(){$("#answers-container").addClass("hide"),$("#form-container").removeClass("hide")}),$(document).on("click",".js-clean-associative-options",function(){$(this).parents(".associative-question").find(".js-associative-select option:selected").removeAttr("selected")}),$(document).on("change",".js-associative-select",function(){var e=$(this).parents(".associative-question"),t=$(this).data("option-index"),n=$(this).find("option:selected").data("first-assertion-id");e.find('.js-associate-assertion[data-option-index="'+t+'"]').val(n)}),$(document).on("change","#exam_answer_form",app.checkFormValidity),$(document).on("input propertychange","#exam_answer_form",app.checkFormValidity),$(document).trigger("app:bind:bind_exam_question_form")}}(),function(){app.bindFixOnScroll=function(){$(".js-fix-on-scroll").each(function(e,t){if($(t).hasClass("js-fix-on-scroll-mobile")||!(window.innerWidth<992)){var n=$(t);n.wrap('<div class="js-fix-scroll-wrapper"/>');var a=n.parent(".js-fix-scroll-wrapper"),o=n.offset(),s={width:n.outerWidth(),height:n.outerHeight()};a.width(s.width),a.height(s.height),$(document).on("scroll",function(e){var t=$(document).scrollTop();if(t>=o.top){if("fixed"===n.css("position"))return;n.parent().addClass("scroll"),n.addClass("scroll"),n.css({position:"fixed",left:o.left,top:0,width:s.width,height:s.height,"z-index":"10000"})}else{if("static"===n.css("position"))return;n.removeClass("scroll"),n.parent().removeClass("scroll"),n.css({position:"static",left:"auto",top:"auto",width:"auto",height:"auto"})}})}})}}(),function(){app.followBind=function(){$(document).on({mouseenter:function(){$(this).addClass("hidden"),$("#js-unfollow").removeClass("hidden")}},"#js-following"),$(document).on({mouseleave:function(){$("#js-following").removeClass("hidden"),$(this).addClass("hidden")}},"#js-unfollow")}}(),function(){app.lessonList={init:function(){var e=this;e.courseTreeExists=e.courseTree().length,e.isActive=e.courseTree().data("is-active"),e.course=e.courseTree().data("course"),e.enrollment=e.courseTree().data("enrollment"),e.courseContent=e.courseTree().data("course-content"),e.userType=e.courseTree().data("user-type"),e.lessonActions=e.courseTree().data("lesson-actions"),e.downloadAction=e.courseTree().data("download-action"),e.currentLessonId=parseInt(e.courseTree().data("current-lesson-id")),e.apiKey=e.courseTree().data("api-key"),e.translations={},e.translations["lesson.release_at"]=e.courseTree().data("translation-release-at"),e.translations["lesson.release_after"]=e.courseTree().data("translation-release-after"),e.translations["product.course_content.views"]=e.courseTree().data("translation-course_content-views"),e.courseTreeExists&&!e.isActive&&(e.bindClicks(),e.handleLessons(),e.loadTopModules(),e.bindChangeLesson(),$(document).trigger("app:bind:lesson_sidebar"),$(document).on("lesson-completed",function(e,t){var n=$(".btn-next-lesson"),a=t.data.enrollment_id;n.size()>0&&n.removeClass("disabled"),app.lessonList.requirementsExists(t.data,function(e,t){t&&app.lessonList.checkLessonCompleted(a,t,function(t){t&&(e.removeClass("blocked"),e.find(".right > .icon-lock").remove())})})}))},courseTree:function(){return $(".course-content #js-course-tree-ajax")},lazyLoadButtons:function(){return $(".course-content #js-course-content-more-link, .course-content #js-course-content-prev-link")},lessons:function(){return this.courseTree().find(".js-content")},currentLesson:function(){return $(this.courseTree().find(".js-content.active")[0])},toggleButton:function(){return $(".lesson-list-toggle .btn")},lessonListPanel:function(){return $(".lesson-list-panel")},requirementsExists:function(e,t,n){if(!e)return!1;var a=$(".lesson-list-panel [data-requirements]").filter(function(e,t){return $(t).data("requirements").length>0}),o=a.map(function(e,t){return{item:$(t),requirements:$(t).data("requirements")}}).toArray(),s=_.find(o,{requirements:[{content_id:e.lesson_id}]});if(s){var i=s.item;if(t)return t(i,e.lesson_id)}else if(n)return n()},checkLessonCompleted:function(e,t,n){var a=!1,o=$(".course-content #js-course-tree-ajax").data("api-key");$.ajax({url:window.CORE_HOST+"/enrollments/"+e+"/lessons_progresses?lesson_id="+t,method:"GET",headers:{Authorization:"Token token="+o}}).success(function(e){a=e.lessons_progresses[0].completed,n(a)})},bindChangeLesson:function(){var e=this;if(!e.bindChangeLessonActive){e.bindChangeLessonActive=!0;var t=/enrollments\/\d+\/courses\/\d+$/,n=/enrollments\/\d+\/courses\/\d+\/course_contents\/\d+$/;$(document).on("ready page:load",function(a){var o=window.location.pathname,s=n.test(o);if((t.test(o)||s)&&(e.lessons().removeClass("active"),s)){var i=o.split("/"),r=i[i.length-1];$("#content-"+r+".js-content").addClass("active")}})}},bindClicks:function(){var e=this;e.lessons().find("a").on("click",function(e){e.preventDefault(),app.lessonList.changeLesson(null,$(this).parents(".js-content"))}),e.courseTree().on("click",".module",function(t){($(t.target).hasClass("module")||$(t.target).parent().hasClass("module"))&&(t.stopPropagation(),e.loadChildren($(this)))}),e.courseTree().data("is-active",!0),e.toggleButton().on("click",this.toggleSidebar)},getLessonIcon:function(e){var t="";if("ExamLesson"==e.type&&e.activity)switch(e.activity.type){case"Quiz":t="icon-puzzle";break;case"FileUpload":t="icon-arrow-up-circle";break;case"CollaborativeDiscussion":t="icon-people";break;default:t="icon-puzzle"}else if(e.media)switch(e.media.type){case"Video":t="icon-camrecorder";break;case"Audio":t="icon-microphone";break;case"Slide":t="icon-chart";break;case"Document":t="icon-doc";break;case"Image":t="icon-picture";break;case"Text":t="icon-doc";break;case"LiveStream":t="icon-control-play";break;case"VideoSlide":t="icon-film";break;case"ScormPackage":t="icon-layers";break;case"Html":t="icon-doc";break;case"Html5":t="icon-docs";break;default:t="icon-camrecorder"}return t},getContentPath:function(e){var t=this,n=t.enrollment.id,a=t.course.id,o=n?"/enrollments/"+n:"/admin_view";return o=o+"/courses/"+a+"/course_contents/"+e.id},getContentDownloadPath:function(e){var t=this;return t.getContentPath(e)+"/download"},checkLessonAvailability:function(e){var t=e.release_at,n=e.release_after;if(!t&&!n)return!0;var a=moment(this.enrollment.activated_at),o=t?moment(t):a.add(n,"days");return moment()>o},checkTrialByType:function(e){var t=$("#js-course-tree-ajax"),n=t.data("enrollment"),a="trial_"+e+"_ids",o=n.payment_method,s=t.data("school-product").trial_constrains,i=s[o];return!(i&&!i.hasOwnProperty(a))&&(n["on_trial?"]?function(e){if(s&&i[a])return i[a].indexOf(e)>-1}:function(){return!1})},fetchModules:function(e){var t=this,n=e.data("id"),a=e.data("level"),o=e.find(".list-group").first();return $.ajax({url:window.CORE_HOST+"/course_modules/"+n,method:"GET",headers:{Authorization:"Token token="+t.apiKey},success:function(e){var n=_.sortBy(e.course_modules,"order");n=_.filter(n,function(e){var n=_.find(t.allModules,{id:e.id});return 0!=n.available&&(n.course_content_ids.length>0||n.course_modules.length>0)});var s=_.map(n,function(e){return $('<li class="list-group-item module" data-id="'+e.id+'"data-level="'+(a+1)+'"><i class="icon icon-arrow-right"></i><span>'+e.name+'</span><i class="busy busy-xs"></i></li>')});o.append(s)}})},fetchChildren:function(e){var t=this,n=e.data("id"),a=(e.data("level"),e.find(".list-group").first());return $.ajax({url:window.CORE_HOST+"/course_modules/"+n+"/course_contents",method:"GET",headers:{Authorization:"Token token="+t.apiKey},success:function(e){var n=t.checkTrialByType("content"),o=_.filter(e.course_contents,function(e){return 0!=e.available});o=_.sortBy(o,"order"),t.enrollment&&(o=_.map(o,function(e){return e.completed=t.enrollment.lessons_info&&t.enrollment.lessons_info.completed.indexOf(e.lesson.id)>-1,e}));var s=_.map(o,function(e){var a=t.currentLessonId==e.lesson.id?"active js":"",s=e.lesson,i=t.getLessonIcon(s),r="hide",c="hide",d=null,l=null,u=null,p=null,m=e.requirements,f=!0,h=m.map(function(e){return e.content_id});t.enrollment&&(d=t.checkLessonAvailability(s),t.enrollment.lessons_info&&t.enrollment.lessons_info.completed.indexOf(s.id)>-1?(r="hide",c=null):t.enrollment.lessons_info&&t.enrollment.lessons_info.in_progress.indexOf(s.id)>-1?(r=null,c="hide"):(r="hide",c="hide"),s.release_at?(l="release_at",u=s.release_at):s.release_after&&(l="release_after",u=moment(t.enrollment.activated_at).add(s.release_after,"days")),t.lessonActions&&(p=_.find(t.enrollment.lessons_progresses,{lesson_id:s.id}))),t.enrollment&&_.each(h,function(e){var t=_.find(o,{content_id:e,completed:!0});t||(f=!1)});var g='<li class="list-group-item content-lesson js-content list-group-item lesson module-item '+a+(!f||n(e.id)?" blocked":"")+'" id="content-'+e.id+"\" data-requirements='"+JSON.stringify(m)+"'data-id=\""+e.lesson.id+'"data-level="1"><div id="lesson-'+s.id+'" class="js-lesson content-lesson '+a+(d?"":" not-released")+'" data-lesson-id="'+s.id+'"><div class="class-info"><div class="left"><i class="'+i+'"></i></div><div class="center">'+(t.lessonActions&&d?'<a class="lesson-title" href="'+t.getContentPath(e)+'"><span>'+s.title+"</span></a>":'<span class="lesson-title"><span class="disabled">'+s.title+"</span></span>")+'</div><div class="right">'+(!f||n(e.id)?'<i class="icon-lock"></i>':"")+'<span class="progress-icon js-progress-icons"><i class="icon-check js-completed-icon '+c+'"></i><i class="icon-clock js-in-progress-icon '+r+'"></i></span>';if(t.lessonActions){if(p&&p.views<=t.enrollment.max_attendance_length&&"attempts"==t.enrollment.max_attendance_type){var v=t.translations["product.course_content.views"];v=v.replace("{{ progress.views }}",p.views),v=v.replace("{{ enrollment.max_attendance_length }}",t.enrollment.max_attendance_length),g+='<span class="lesson-views attempt js-attendance badge" title="'+v+'" data-tooltip-placement="left" data-toggle="tooltip"><span>'+p.views+"/"+t.enrollment.max_attendance_length+"</span></span>"}if(!d){var b=moment.tz.guess();g+='<span class="release-date badge">'+t.translations["lesson."+l]+"<span> "+moment.tz(u,b).format("DD/MM/YYYY")+"</span></span>"}t.downloadAction&&e.downloadable&&(g+='<a class="download-link" href="'+t.getContentDownloadPath(e)+'" data-no-turbolink><i class="icon-cloud-download"></i></a>')}return g+="</div></div></li>",$(g)});a.append(s),t.checkNextButtonUnlocked()}})},checkNextButtonUnlocked:function(){var e=$("#js-course-tree-ajax").data("lesson-progress");app.lessonList.requirementsExists(e,function(t,n){n&&e.hasOwnProperty("enrollment_id")&&app.lessonList.checkLessonCompleted(e.enrollment_id,n,function(e){e&&($(".btn-next-lesson").removeClass("disabled"),t.removeClass("blocked"),t.find(".right > .icon-lock").remove())})},function(){$(".btn-next-lesson").removeClass("disabled")})},loadTopModules:function(){var e=this;e.course&&$.ajax({url:window.CORE_HOST+"/courses/"+e.course.id+"/course_modules",method:"GET",headers:{Authorization:"Token token="+e.apiKey},success:function(t){var n=e.checkTrialByType("module");if(t.course_modules&&!(t.course_modules.length<=0)){e.allModules=t.course_modules,e.topModules=_.filter(t.course_modules,function(e){return null==e.parent_course_module&&0!=e.available&&(e.course_content_ids.length>0||e.course_modules.length>0)}),e.topModules=_.sortBy(e.topModules,"order");var a=_.map(e.topModules,function(e){var t=n(e.id);return $('<li class="list-group-item module '+(t?"disabled":"")+'" data-id="'+e.id+'"data-level="1"><i class="icon icon-arrow-right"></i><span>'+e.name+'</span><i class="busy busy-xs"></i></li>')});e.courseTree().prev(".course-content-busy").fadeOut("fast",function(){e.courseTree().css("display","none"),e.courseTree().html(a),e.courseTree().fadeIn("fast"),e.courseContent&&e.expandParentModules(e.courseContent.parent_modules_hash)})}}})},loadChildren:function(e,t){var n=this,a=$(e),o=(a.data("id"),a.data("level"),a.find(".list-group").first());o.length<=0?(a.find(".busy").css({opacity:1}),o=$('<ul class="list-group" style="display: none;"></ul>'),o.appendTo(a),$.when(n.fetchModules(a),n.fetchChildren(a)).then(function(){a.addClass("expanded"),a.find(".busy").css({opacity:0}),o.slideDown("fast"),"function"==typeof t&&t()})):(a.hasClass("expanded")?(a.removeClass("expanded"),o.slideUp("fast")):(a.addClass("expanded"),o.slideDown("fast")),"function"==typeof t&&t())},handleLessons:function(){$(document).on("page:load page:restore",function(e){if(e.originalEvent&&e.originalEvent.data&&0!=e.originalEvent.data.length){var t=$(e.originalEvent.data[0]);app.lessonList.lessons().each(function(e,n){var a=$(n),o=t.find("#"+a.attr("id"));a.html(o.html())})}})},changeLesson:function(e,t){var n=$(t);if("prev"==e){var a=app.lessonList.currentLesson().prevAll(".js-content");a.length>0&&a.find("a").length>0&&(n=$(a[0]))}else if("next"==e){var o=app.lessonList.currentLesson().nextAll(".js-content");o.length>0&&o.find("a").length>0&&(n=$(o[0]))}n.find("a")[0].click()},expandParentModules:function(e){var t=this,n=[],a=e.course_module;for(n.push(a.id);a.parent_module;)a=a.parent_module,n.push(a.id);n=n.reverse(),async.eachSeries(n,function(e,n){var a=$('.module[data-id="'+e+'"]');t.loadChildren(a,n)})},toggleSidebar:function(){app.lessonList.toggleButton().toggleClass("active"),app.lessonList.lessonListPanel().toggleClass("active")}}}(),function(){app.lessonPage=function(){var e=/\/collaborative_discussions\/([0-9]+)\/collaborative_comments/,t=/\/exam_answers/,n=function(t){return e.test(t)},a=function(e){return t.test(e)};$(document).ajaxSuccess(function(e,t,o){if(n(o.url)||a(o.url)){var s=$("#js-course-tree-ajax").data("lesson-progress");app.lessonList.requirementsExists(s,function(e,t){t&&s.hasOwnProperty("enrollment_id")&&app.lessonList.checkLessonCompleted(s.enrollment_id,t,function(t){t&&($(".btn-next-lesson").removeClass("disabled"),e.removeClass("disabled"),e.find(".right > .icon-lock").remove())})},function(){$(".btn-next-lesson").removeClass("disabled")})}})}}(),function(){app.bindMasks=function(){var e=function(e){return 11===e.replace(/\D/g,"").length?"(00) 00000-0000":"(00) 0000-00009"},t={onKeyPress:function(t,n,a,o){a.mask(e.apply({},arguments),o)}};$("#user-phone").mask(e,t),$("#user-cpf").mask("999.999.999-99"),$("#user-cep").mask("99.999-999"),$(document).trigger("app:bind:masks")}}(),app.notepad={page:1,noteContainer:function(){return $("#notepad-container")},form:function(){return $("#js-notepad-form")},loadNote:function(e,t){$.ajax({url:window.location.pathname+"/notepads",method:"GET",success:function(){"function"==typeof t&&t()}})},saveNote:function(e){var t=$("#js-note").html(),n=$("#js_note_id").val(),a=$("#save_notepad_button"),o=a.html();a.html(a.data("sending")),a.prop("disabled",!0),$.ajax({url:window.location.pathname+"/notepads",method:"POST",data:{_id:n,note:t},success:function(){a.html(o),a.prop("disabled",!1),"function"==typeof e&&e()}})},init:function(){var e=this;this.noteContainer().length<=0||(this.loadNote($("#lesson_id").val()),$("#notepad_form").on("submit",function(t){t.preventDefault(),e.saveNote()}))}},function(){app.pagarme={buildCreditCard:function(){var e=new PagarMe.creditCard,t=$("#card-form #card-expiration").val().split("/");return e.cardExpirationMonth=parseInt(t[0]),e.cardExpirationYear=parseInt(t[1]),e.cardHolderName=$("#card-form #card-holder-name").val(),e.cardNumber=$("#card-form #card-number").val(),e.cardCVV=$("#card-form #card-cvc").val(),e},submitFormCreditCardHash:function(e){var t=app.pagarme.buildCreditCard(),n=t.fieldErrors(),a=!1;for(var o in n){a=!0;break}console.log(1),window.creditCardTest=t,a?(window.fieldErrors=n,console.log(window.fieldErrors)):t.generateHash(function(t){$("#card_hash").val(t),e.get(0).submit()})},init:function(){var e="https://assets.pagar.me/js/pagarme.min.js",t=$("#card-form"),n=$("#pagarme").val();t.length&&n&&loadAsset("PagarMe",e,function(){PagarMe.encryption_key=n,t.submit(function(e){e.preventDefault(),app.pagarme.submitFormCreditCardHash(t)}),$(document).trigger("app:bind:pagarme")})}}}(),function(){app.bindPostsForm=function(){$(document).on("click",".js-post-edit",function(){var e=$(this).parents(".js-post");e.find(".js-post-body").addClass("hidden"),e.find(".js-post-form").removeClass("hidden")}),$(document).on("click",".js-post-cancel",function(e){var t=$(this).parents(".js-post");t.find(".js-post-body").removeClass("hidden"),t.find(".js-post-form").addClass("hidden")}),$(document).trigger("app:bind:bind_posts_form")}}(),function(){app.bindReadMore=function(){$('[role="readmore"]').each(function(e,t){var n=$(t).data("speed")||100,a=$(t).data("collapsed-height")||200,o=$(t).data("more-text")||"Leia Mais",s=$(t).data("less-text")||"Fechar",i=$(t).innerHeight(),r=i<=a;$(t).readmore({speed:n,collapsedHeight:a,moreLink:'<a href="#" class="'+(r?"hidden":"readmore-link")+'">'+o+"</a>",lessLink:'<a href="#" class="'+(r?"hidden":"readmore-link")+'">'+s+"</a>"})})}}(),function(){app.simpleEditor={createShortcut:function(e,t){var n=navigator.platform.toUpperCase().indexOf("MAC")>=0,a=function(a){var o=String.fromCharCode(a.keyCode),s=a.ctrlKey,i=!!a.metaKey,r=0;if(n&&i?r++:s&&r++,o==e&&r++,2==r)return a.stopPropagation(),a.preventDefault(),t()};$("body").bind("keydown",a)},handleDrag:function(e){e.stopPropagation(),e.preventDefault()},handleDrop:function(e){e.stopPropagation(),e.preventDefault();var t=e.clientX,n=e.clientY,a=e.dataTransfer.files[0],o=window.URL||window.webkitURL,s=o.createObjectURL(a);if(a.type.match("image.*")){var i=document.createElement("img");if(i.src=s,document.caretPositionFromPoint){var r=document.caretPositionFromPoint(t,n);range=document.createRange(),range.setStart(r.offsetNode,r.offset),range.collapse(),range.insertNode(i)}else document.caretRangeFromPoint&&(range=document.caretRangeFromPoint(t,n),range.insertNode(i))}},updateButtons:function(){var e=document.queryCommandState("Bold"),t=document.queryCommandState("Italic"),n=document.queryCommandState("Underline");e===!0?$("[data-action=bold]").addClass("active"):$("[data-action=bold]").removeClass("active"),t===!0?$("[data-action=italic]").addClass("active"):$("[data-action=italic]").removeClass("active"),n===!0?$("[data-action=underline]").addClass("active"):$("[data-action=underline]").removeClass("active")},init:function(e){this.$container=$(e),this.$input=this.$container.find(".js-input"),this.$btnAction=this.$container.find(".js-btn-action"),this.registerTriggers(),this.registerDropZone(),this.registerShortcuts()},registerTriggers:function(){var e=this;e.$btnAction.on("click",function(){var e=$(this).attr("data-action");document.execCommand(e),app.simpleEditor.updateButtons()}),e.$input.on("click",function(){app.simpleEditor.updateButtons()}),e.$input.on("focusin",function(){e.$container.addClass("focused")}),e.$input.on("focusout",function(){e.$container.removeClass("focused")})},registerDropZone:function(){var e=$(this.container).find(".js-input");e.on("dragover",app.simpleEditor.handleDrag,!1),e.on("drop",app.simpleEditor.handleDrop,!1)},registerShortcuts:function(){app.simpleEditor.createShortcut("U",function(){document.execCommand("underline"),app.simpleEditor.updateButtons()}),app.simpleEditor.createShortcut("B",function(){document.execCommand("bold"),app.simpleEditor.updateButtons()}),app.simpleEditor.createShortcut("I",function(){document.execCommand("italic"),app.simpleEditor.updateButtons()})}}}(),app.studentDoubts={page:1,doubtsContainer:function(){return $("#js-doubts-container")},form:function(){return $("#js-student-doubts-form")},expandButton:function(){return $("#js-expand-student-doubts-form")},hideButton:function(){return $("#js-hide-student-doubts-form")},loadMoreButton:function(){return $("#js-load-more-doubts")},loadDoubts:function(e){var t=this;$.ajax({url:window.location.pathname+"/student_doubts/page/"+t.page,method:"GET",data:{per_page:3},complete:function(){"function"==typeof e&&e()}})},init:function(){var e=this;e.doubtsContainer().length<=0||(e.expandButton().on("click",function(){e.expandButton().hide(),e.form().slideDown("fast")}),e.hideButton().on("click",function(){e.form().slideUp("fast",function(){e.expandButton().fadeIn("fast")})}),e.loadMoreButton().on("click",function(){e.page=e.page+1;var t=$(this);t.attr("disabled","disabled"),e.loadDoubts(function(){t.removeAttr("disabled")})}),e.loadDoubts())}},function(){app.changeTimeZone=function(){$(".js-to-client-timezone").each(function(e,t){var n=$(t),a=n.data("format"),o=moment.tz.guess(),s=n.data("timezone");n.html(moment.tz(s,o).format(a))}),$(document).trigger("app:change:timezone")},app.changeTimeZone()}(),function(){$(document).on("page:load",function(){app.init()}),$(document).on("page:partial-load",function(){app.bindBlazy()}),$(document).ready(function(){app.init()})}();
//# sourceMappingURL=theme.base.min.js.map
