"use strict";!function(){window.app={bindGlobal:function(){FastClick.attach(document.body),$(".timeago").timeago(),$(document).trigger("app:bind:global")},bindOpenOnLoad:function(){var e=$(".js-open-on-load");e.length>0&&$.each(e,function(e,n){window.open($(n).attr("href"))}),$(document).trigger("app:bind:open_on_load")},bindTooltips:function(){$("[data-toggle='tooltip']").tooltip("destroy").tooltip(),$(document).trigger("app:bind:tooltips")},checkFormValidity:function(e){var n=e.currentTarget,t=$(n).find('button[type="submit"]');n.checkValidity()?t.removeAttr("disabled"):t.attr("disabled","disabled"),$(document).trigger("app:bind:check_form_validity")},init:function(){app.pagarme.init(),app.bindGlobal(),app.bindBlazy(),app.bindOpenOnLoad(),app.bindMasks(),app.bindTooltips(),app.bindReadMore(),app.bindDatepicker(),app.bindFixOnScroll(),app.ckeditor.bindCkeditor(),app.bindCheckout(),app.lessonSidebar.init(),app.lessonSidebarAjax.init(),app.bindExamQuestionForm(),app.changeTimeZone(),app.followBind(),app.bindPostsForm(),$(document).on("app:bind:ckeditor_submit",app.bindCollaborativeDiscussion)}}}(),function(){app.bindBlazy=function(e){new Blazy,$(document).trigger("app:bind:blazy")}}(),function(){app.bindCheckout=function(){$("#js-terms-of-use-check").change(function(){$(this).is(":checked")===!0?$(".cta-checkout-cart").removeClass("disabled"):$(".cta-checkout-cart").addClass("disabled")}),$(document).trigger("app:bind:checkout")}}(),function(){app.ckeditor={bindCkeditor:function(){var e="//cdn.edools.com/libs/ckeditor/4.5.10/ckeditor.js";$(".js-ckeditor").length&&loadAsset("window.CKEDITOR",e,function(){var e={language:"pt-br",skin:"bootstrapck"};$(".js-ckeditor").each(function(n,t){$("#cke_"+t.id).length||(e.placeholder=t.placeholder,CKEDITOR.replace(t.id,e))}),app.ckeditor.bindCkeditorSubmit(),$(document).trigger("app:bind:ckeditor")})},bindCkeditorSubmit:function(){$.each($(".js-ckeditor"),function(e,n){var t=$(n),a=t.parents("form"),o=t.attr("id");if(a){var s=a.find('button[type="submit"]');CKEDITOR.instances[o].on("change",function(){this.getData().length?s.attr("disabled",!1):s.attr("disabled",!0)})}}),$(document).trigger("app:bind:ckeditor_submit")}}}(),function(){app.bindCollaborativeDiscussion=function(){$(document).on("click","#collaborative-discussion .js-edit-button",function(){var e=$(this).data("comment-id"),n=$("#js-comment-"+e);n.find(".js-show-comment").addClass("hide"),n.find(".js-edit-container").removeClass("hide")}),$(document).on("click","#collaborative-discussion .js-cancel-button",function(){var e=$(this).data("comment-id"),n=$("#js-comment-"+e);n.find(".js-show-comment").removeClass("hide"),n.find(".js-edit-container").addClass("hide")}),$(document).trigger("app:bind:collaborative_discussion")}}(),function(){app.bindDatepicker=function(){$.fn.datepicker.defaults.language="pt-BR",$(".datepicker").each(function(e,n){var t=$(n),a=$('<input type="hidden" />').insertBefore(t.parent()),o=moment(t.val()).utc().format("DD/MM/YYYY"),s=moment(t.val()).utc().format("YYYY-MM-DD");s="Invalid date"===s?null:s,a.attr("id",t.attr("id")),a.attr("name",t.attr("name")),a.attr("value",s),t.removeAttr("id"),t.removeAttr("name"),""!==t.val()&&t.val(o),$(n).datepicker().on("change",function(){var e=moment(t.val(),"DD/MM/YYYY").utc().format("YYYY-MM-DD");e="Invalid date"===e?null:e,a.val(e)})}),$(document).trigger("app:bind:datepicker")}}(),function(){app.bindExamQuestionForm=function(){$(document).on("click","#js-remake-exam",function(){$("#answers-container").addClass("hide"),$("#form-container").removeClass("hide")}),$(document).on("click","#js-clean-associative-options",function(e){$(".js-associative-select option:selected").removeAttr("selected")}),$(document).on("change",".js-associative-select",function(e){var n=$(this).data("option-index"),t=$(this).find("option:selected").data("first-assertion-id");$('.js-associate-assertion[data-option-index="'+n+'"]').val(t)}),$(document).on("change","#exam_answer_form",app.checkFormValidity),$(document).on("input propertychange","#exam_answer_form",app.checkFormValidity),$(document).trigger("app:bind:bind_exam_question_form")}}(),function(){app.bindFixOnScroll=function(){window.innerWidth<992||$(".js-fix-on-scroll").each(function(e,n){var t=$(n);t.wrap('<div class="js-fix-scroll-wrapper"/>');var a=t.parent(".js-fix-scroll-wrapper"),o=t.offset(),s={width:t.outerWidth(),height:t.outerHeight()};a.width(s.width),a.height(s.height),$(document).on("scroll",function(e){var n=$(document).scrollTop();if(n>=o.top){if("fixed"===t.css("position"))return;t.addClass("scroll"),t.css({position:"fixed",left:o.left,top:0,width:s.width,height:s.height,"z-index":"10000"})}else{if("static"===t.css("position"))return;t.removeClass("scroll"),t.css({position:"static",left:"auto",top:"auto",width:"auto",height:"auto"})}})})}}(),function(){app.followBind=function(){$(document).on({mouseenter:function(){$(this).addClass("hidden"),$("#js-unfollow").removeClass("hidden")}},"#js-following"),$(document).on({mouseleave:function(){$("#js-following").removeClass("hidden"),$(this).addClass("hidden")}},"#js-unfollow")}}(),function(){app.lessonSidebar={init:function(){this.nextButton().on("click",this.nextLesson),this.prevButton().on("click",this.prevLesson),this.lessons().find("a").on("click",function(e){e.preventDefault(),app.lessonSidebar.changeLesson(null,$(this).parents(".js-content"))}),this.lazyLoadButtons().on("click",app.lessonSidebar.resetTooltips),this.handleButtons(),this.handleLessons();var e=$(".course-content");if(e.length<=0)return void $(document).trigger("app:bind:lesson_sidebar");var n=e.find(".module.sub-1").first();app.lessonSidebar.toggleChildren(n,"expand"),$(document).on("page:change",function(){e.find(".module.expanded").each(function(e,n){app.lessonSidebar.toggleChildren($(n),"collapse",function(){app.lessonSidebar.toggleChildren($(n),"expand")})})}),e.off("click").on("click",".module",function(){$(this).hasClass("expanded")?app.lessonSidebar.toggleChildren($(this),"collapse"):app.lessonSidebar.toggleChildren($(this),"expand")}),$(document).trigger("app:bind:lesson_sidebar")},lazyLoadButtons:function(){return $("#js-course-content-more-link, #js-course-content-prev-link")},prevButton:function(){return $("#js-lesson-content-player").find(".js-btn-prev")},nextButton:function(){return $("#js-lesson-content-player").find(".js-btn-next")},handleButtons:function(){var e=this.currentLesson().nextAll(".js-content"),n=this.currentLesson().prevAll(".js-content");e.length<=0||e.find("a").length<=0?app.lessonSidebar.nextButton().attr("disabled","disabled"):app.lessonSidebar.nextButton().removeAttr("disabled"),n.length<=0||n.find("a").length<=0?app.lessonSidebar.prevButton().attr("disabled","disabled"):app.lessonSidebar.prevButton().removeAttr("disabled")},handleLessons:function(){app.lessonSidebar.expandParentModule(app.lessonSidebar.currentLesson()),$(document).on("page:load page:restore",function(e){if(e.originalEvent.data&&0!=e.originalEvent.data.length){var n=$(e.originalEvent.data[0]);app.lessonSidebar.lessons().each(function(e,t){var a=$(t),o=n.find("#"+a.attr("id"));a.html(o.html())})}})},lessons:function(){return $(".lesson-page #js-course-tree").find(".js-content")},currentLesson:function(){return $($(".lesson-page #js-course-tree").find(".js-content.active")[0])},changeLesson:function(e,n){var t=$(n);if("prev"==e){var a=app.lessonSidebar.currentLesson().prevAll(".js-content");a.length>0&&a.find("a").length>0&&(t=$(a[0]))}else if("next"==e){var o=app.lessonSidebar.currentLesson().nextAll(".js-content");o.length>0&&o.find("a").length>0&&(t=$(o[0]))}app.lessonSidebar.expandParentModule(t),t.find("a")[0].click()},prevLesson:function(){app.lessonSidebar.changeLesson("prev")},nextLesson:function(){app.lessonSidebar.changeLesson("next")},getModuleIndex:function(e){var n=null;return $(e.attr("class").split(" ")).each(function(e,t){t.indexOf("sub-")>-1&&(n=parseInt(t.replace("sub-","")))}),n},expandParentModule:function(e){var n=[],t=!1;$(e).prevAll(".module").each(function(e,a){var o=$(a);t||n.push(o),1==app.lessonSidebar.getModuleIndex(o)&&(t=!0)}),n=n.filter(function(n,t){return 0==t||app.lessonSidebar.getModuleIndex($(n))<app.lessonSidebar.getModuleIndex($(e))-1}),n=n.reverse(),$(n).each(function(e,n){app.lessonSidebar.toggleChildren(n,"expand")})},toggleChildren:function(e,n,t){if(!(e.length<=0)){var a=$(e),o=app.lessonSidebar.getModuleIndex(a),s=a.nextUntil(".sub-"+o).filter(function(){return app.lessonSidebar.getModuleIndex($(this))==app.lessonSidebar.getModuleIndex(a)+1}),i=s.filter(function(){return $(this).hasClass("module")});"expand"==n?(a.addClass("expanded"),s.removeClass("hidden")):"collapse"==n&&(a.removeClass("expanded"),s.addClass("hidden")),i.each(function(e,n){app.lessonSidebar.toggleChildren(n,"collapse")}),t&&t()}}}}(),function(){app.lessonSidebarAjax={init:function(){var e=this;e.isActive=e.courseTree().data("is-active"),e.course=e.courseTree().data("course"),e.enrollment=e.courseTree().data("enrollment"),e.courseContent=e.courseTree().data("course-content"),e.userType=e.courseTree().data("user-type"),e.lessonActions=e.courseTree().data("lesson-actions"),e.downloadAction=e.courseTree().data("download-action"),e.currentLessonId=parseInt(e.courseTree().data("current-lesson-id")),e.apiKey=e.courseTree().data("api-key"),e.translations={},e.translations["lesson.release_at"]=e.courseTree().data("translation-release-at"),e.translations["lesson.release_after"]=e.courseTree().data("translation-release-after"),e.translations["product.course_content.views"]=e.courseTree().data("translation-course_content-views"),e.isActive||(e.bindClicks(),e.handleLessons(),e.loadTopModules(),$(document).trigger("app:bind:lesson_sidebar"))},courseTree:function(){return $(".course-content-ajax #js-course-tree-ajax")},lazyLoadButtons:function(){return $(".course-content-ajax #js-course-content-more-link, .course-content-ajax #js-course-content-prev-link")},lessons:function(){return this.courseTree().find(".js-content")},currentLesson:function(){return $(this.courseTree().find(".js-content.active")[0])},toggleButton:function(){return $(".lesson-sidebar-toggle .btn")},lessonSidebarPanel:function(){return $(".lesson-sidebar-panel")},bindClicks:function(){var e=this;e.lessons().find("a").on("click",function(e){e.preventDefault(),app.lessonSidebar.changeLesson(null,$(this).parents(".js-content"))}),e.courseTree().on("click",".module",function(n){($(n.target).hasClass("module")||$(n.target).parent().hasClass("module"))&&(n.stopPropagation(),e.loadChildren($(this)))}),e.courseTree().data("is-active",!0),e.toggleButton().on("click",this.toggleSidebar)},getLessonIcon:function(e){var n="";if("ExamLesson"==e.type&&e.activity)switch(e.activity.type){case"Quiz":n="icon-puzzle";break;case"FileUpload":n="icon-arrow-up-circle";break;case"CollaborativeDiscussion":n="icon-people";break;default:n="icon-puzzle"}else if(e.media)switch(e.media){case"Video":n="icon-camrecorder";break;case"Audio":n="icon-microphone";break;case"Slide":n="icon-chart";break;case"Document":n="fa fa-file-text-o";break;case"Image":n="icon-picture";break;case"Text":n="fa fa-file-text-o";break;case"LiveStream":n="icon-control-play";break;case"VideoSlide":n="icon-film";break;case"ScormPackage":n="icon-layers";break;case"Html":n="icon-doc";break;default:n="icon-camrecorder"}return n},getContentPath:function(e){var n=this,t=n.enrollment.id,a=n.course.id,o=t?"/enrollments/"+t:"/admin_view";return o=o+"/courses/"+a+"/course_contents/"+e.id},getContentDownloadPath:function(e){var n=this;return n.getContentPath(e)+"/download"},checkLessonAvailability:function(e){var n=e.release_at,t=e.release_after;if(!n&&!t)return!0;var a=moment(this.enrollment.activated_at),o=n?moment(n):a.add(t,"days");return moment()>o},fetchModules:function(e){var n=this,t=e.data("id"),a=e.data("level"),o=e.find(".list-group").first();return $.ajax({url:window.CORE_HOST+"/course_modules/"+t,method:"GET",headers:{Authorization:"Token token="+n.apiKey},success:function(e){var t=_.sortBy(e.course_modules,"order");t=_.filter(t,function(e){var t=_.find(n.allModules,{id:e.id});return 0!=t.available&&(t.course_content_ids.length>0||t.course_modules.length>0)});var s=_.map(t,function(e){return $('<li class="list-group-item module" data-id="'+e.id+'"data-level="'+(a+1)+'"><i class="icon icon-arrow-right"></i><span>'+e.name+'</span><i class="busy"></i></li>')});o.append(s)}})},fetchChildren:function(e){var n=this,t=e.data("id"),a=(e.data("level"),e.find(".list-group").first());return $.ajax({url:window.CORE_HOST+"/course_modules/"+t+"/course_contents",method:"GET",headers:{Authorization:"Token token="+n.apiKey},success:function(e){var t=_.filter(e.course_contents,function(e){return 0!=e.available});t=_.sortBy(t,"order");var o=_.map(t,function(e){var t=n.currentLessonId==e.lesson.id?"active js":"",a=e.lesson,o=n.getLessonIcon(a),s="hide",i="hide",r=null,d=null,l=null,c=null;n.enrollment&&(r=n.checkLessonAvailability(a),n.enrollment.lessons_info&&n.enrollment.lessons_info.completed.indexOf(a.id)>-1?(s="hide",i=null):n.enrollment.lessons_info&&n.enrollment.lessons_info.in_progress.indexOf(a.id)>-1?(s=null,i="hide"):(s="hide",i="hide"),a.release_at?(d="release_at",l=a.release_at):a.release_after&&(d="release_after",l=moment(n.enrollment.activated_at).add(a.release_after,"days")),n.lessonActions&&(c=_.find(n.enrollment.lessons_progresses,{lesson_id:a.id})));var u='<li class="list-group-item content-lesson js-content list-group-item lesson module-item '+t+'" id="content-'+e.id+'" data-id="'+e.lesson.id+'"data-level="1"><div id="lesson-'+a.id+'" class="js-lesson content-lesson class '+t+'" data-lesson-id="'+a.id+'"><div class="class-info"><div class="left"><i class="'+o+'"></i></div><div class="center">'+(n.lessonActions&&r&&"Student"==n.userType?'<a class="lesson-title" href="'+n.getContentPath(e)+'"><span>'+a.title+"</span></a>":'<span class="lesson-title"><span class="disabled">'+a.title+"</span></span>")+'</div><div class="right"><span class="progress-icon js-progress-icons"><i class="icon-check js-completed-icon '+i+'"></i><i class="icon-clock js-in-progress-icon '+s+'"></i></span>';if(n.lessonActions){if(c&&c.views<=n.enrollment.max_attendance_length&&"attempts"==n.enrollment.max_attendance_type&&(u+='<span class="lesson-views attempt js-attendance" title="'+n.translations["product.course_content.views"]+'" data-tooltip-placement="left" data-toggle="tooltip"><span>'+c.views+"/"+n.enrollment.max_attendance_length+"</span>"),!r){var p=moment.tz.guess();u+='<span class="release-date badge">'+n.translations["lesson."+d]+"<span> "+moment.tz(l,p).format("DD/MM/YYYY")+"</span></span>"}n.downloadAction&&e.downloadable&&(u+='<a class="download-link" href="'+n.getContentDownloadPath(e)+'" data-no-turbolink><i class="icon-cloud-download"></i></a>')}return u+="</div></div></li>",$(u)});a.append(o)}})},loadTopModules:function(){var e=this;e.course&&$.ajax({url:window.CORE_HOST+"/courses/"+e.course.id+"/course_modules",method:"GET",headers:{Authorization:"Token token="+e.apiKey},success:function(n){if(n.course_modules&&!(n.course_modules.length<=0)){e.allModules=n.course_modules,e.topModules=_.filter(n.course_modules,function(e){return null==e.parent_course_module&&0!=e.available&&(e.course_content_ids.length>0||e.course_modules.length>0)}),e.topModules=_.sortBy(e.topModules,"order");var t=_.map(e.topModules,function(e){return $('<li class="list-group-item module" data-id="'+e.id+'"data-level="1"><i class="icon icon-arrow-right"></i><span>'+e.name+'</span><i class="busy"></i></li>')});e.courseTree().prev(".busy").fadeOut("fast",function(){e.courseTree().css("display","none"),e.courseTree().html(t),e.courseTree().fadeIn("fast"),e.courseContent&&e.expandParentModules(e.courseContent.parent_modules_hash)})}}})},loadChildren:function(e,n){var t=this,a=$(e),o=(a.data("id"),a.data("level"),a.find(".list-group").first());o.length<=0?(a.find(".busy").css({opacity:1}),o=$('<div class="list-group"></div>'),o.appendTo(a),$.when(t.fetchModules(a),t.fetchChildren(a)).then(function(){a.addClass("expanded"),a.find(".busy").css({opacity:0}),o.slideDown("fast"),"function"==typeof n&&n()})):(a.hasClass("expanded")?(a.removeClass("expanded"),o.slideUp("fast")):(a.addClass("expanded"),o.slideDown("fast")),"function"==typeof n&&n())},handleLessons:function(){$(document).on("page:load page:restore",function(e){if(0!=e.originalEvent.data.length){var n=$(e.originalEvent.data[0]);app.lessonSidebar.lessons().each(function(e,t){var a=$(t),o=n.find("#"+a.attr("id"));a.html(o.html())})}})},changeLesson:function(e,n){var t=$(n);if("prev"==e){var a=app.lessonSidebar.currentLesson().prevAll(".js-content");a.length>0&&a.find("a").length>0&&(t=$(a[0]))}else if("next"==e){var o=app.lessonSidebar.currentLesson().nextAll(".js-content");o.length>0&&o.find("a").length>0&&(t=$(o[0]))}t.find("a")[0].click()},prevLesson:function(){app.lessonSidebar.changeLesson("prev")},nextLesson:function(){app.lessonSidebar.changeLesson("next")},expandParentModules:function(e){var n=this,t=[],a=e.course_module;for(t.push(a.id);a.parent_module;)a=a.parent_module,t.push(a.id);t=t.reverse(),async.eachSeries(t,function(e,t){var a=$('.module[data-id="'+e+'"]');n.loadChildren(a,t)})},toggleSidebar:function(){app.lessonSidebarAjax.toggleButton().toggleClass("active"),app.lessonSidebarAjax.lessonSidebarPanel().toggleClass("active")}}}(),function(){app.bindMasks=function(){var e=function(e){return 11===e.replace(/\D/g,"").length?"(00) 00000-0000":"(00) 0000-00009"},n={onKeyPress:function(n,t,a,o){a.mask(e.apply({},arguments),o)}};$("#user-phone").mask(e,n),$("#user-cpf").mask("999.999.999-99"),$("#user-cep").mask("99.999-999"),$(document).trigger("app:bind:masks")}}(),function(){app.pagarme={buildCreditCard:function(){var e=new PagarMe.creditCard,n=$("#card-form #card-expiration").val().split("/");return e.cardExpirationMonth=parseInt(n[0]),e.cardExpirationYear=parseInt(n[1]),e.cardHolderName=$("#card-form #card-holder-name").val(),e.cardNumber=$("#card-form #card-number").val(),e.cardCVV=$("#card-form #card-cvc").val(),e},submitFormCreditCardHash:function(e){var n=app.pagarme.buildCreditCard(),t=n.fieldErrors(),a=!1;for(var o in t){a=!0;break}console.log(1),window.creditCardTest=n,a?(window.fieldErrors=t,console.log(window.fieldErrors)):n.generateHash(function(n){$("#card_hash").val(n),e.get(0).submit()})},init:function(){var e="https://assets.pagar.me/js/pagarme.min.js",n=$("#card-form"),t=$("#pagarme").val();n.length&&t&&loadAsset("PagarMe",e,function(){PagarMe.encryption_key=t,n.submit(function(e){e.preventDefault(),app.pagarme.submitFormCreditCardHash(n)}),$(document).trigger("app:bind:pagarme")})}}}(),function(){app.bindPostsForm=function(){$(document).on("click",".js-post-edit",function(){var e=$(this).parents(".js-post");e.find(".js-post-body").addClass("hidden"),e.find(".js-post-form").removeClass("hidden")}),$(document).on("click",".js-post-cancel",function(e){var n=$(this).parents(".js-post");n.find(".js-post-body").removeClass("hidden"),n.find(".js-post-form").addClass("hidden")}),$(document).trigger("app:bind:bind_posts_form")}}(),function(){app.bindReadMore=function(){$('[role="readmore"]').each(function(e,n){var t=$(n).data("speed")||100,a=$(n).data("collapsed-height")||200,o=$(n).data("more-text")||"Leia Mais",s=$(n).data("less-text")||"Fechar",i=$(n).innerHeight(),r=a>=i;$(n).readmore({speed:t,collapsedHeight:a,moreLink:'<a href="#" class="'+(r?"hidden":"readmore-link")+'">'+o+"</a>",lessLink:'<a href="#" class="'+(r?"hidden":"readmore-link")+'">'+s+"</a>"})})}}(),function(){app.changeTimeZone=function(){$(".js-to-client-timezone").each(function(e,n){var t=$(n),a=t.data("format"),o=moment.tz.guess(),s=t.data("timezone");t.html(moment.tz(s,o).format(a))}),$(document).trigger("app:change:timezone")},app.changeTimeZone()}(),function(){$(document).on("page:load",function(){app.init()}),$(document).on("page:partial-load",function(){app.bindBlazy()}),$(document).ready(function(){app.init()})}();
//# sourceMappingURL=theme.base.min.js.map
