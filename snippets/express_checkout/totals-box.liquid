{% if coupon %}
{% if coupon_token.code %}
{% assign couponName = coupon_token.code %}
{% elsif coupon %}
{% assign couponName =  coupon.name %}
{% endif %}
<div class="row js-remove-coupon-container">
  <div class="col-xs-9">
    {{ 'express_checkout.applied_coupon' | t: name: couponName }}
  </div>
  <div class="col-xs-3">
    <div class="pull-right">
      <a href="/express_checkout/remove_coupon?payment_option_id={{ payment_option.id }}" data-remote="true"
        data-disable-with="<i class='busy busy-xs'></i>">
        <u id="link-remove-coupon">{{ 'express_checkout.remove' | t }}</u>
      </a>
    </div>
  </div>
</div>
{% endif %}

<section id="js-totals-box">
  {% assign paymentOption = payment_option | default: order %}
  {% assign discount = paymentOption.price | minus: paymentOption.total %}

  {% if discount > 0 %}
  <div class="totals-box-container">
    <div class="totals-box-item">{{ 'express_checkout.original_price_text' | t }}</div>
    <div class="totals-box-item product-value-text">
      {{ paymentOption.price | money_option_presentation: paymentOption.kind, paymentOption.period, 'full', 1 }}
    </div>
  </div>

  <div class="totals-box-container">
    <div class="totals-box-item discount-text">{{ 'express_checkout.discount_text' | t }}</div>
    <div class="totals-box-item discount-text">-
      {{ discount | money_option_presentation: paymentOption.kind, paymentOption.period, 'full', 1}}</div>
  </div>

  <hr class="divider">
  {% endif %}

  <div class="totals-box-container">
    <div class="totals-box-item">
      <b>
        {% if paymentOption.amount_to_pay %}
          {{ 'checkout.total_paid' | t }}
        {% else %}
          {{ 'checkout.total_amount_to_pay' | t }}
        {% endif %}
      </b>
    </div>
    <div class="totals-box-item product-value-text">
      <span>
        <b id="js-payment-total">
          {% if paymentOption.kind == 'free' %}
          {{ 'product.pricing.free.unitary' | t }}
          {% else %}
          {{ paymentOption.amount_to_pay | default: paymentOption.total | money_option_presentation: paymentOption.kind, paymentOption.period, 'full', 1 }}
          {% endif %}
        </b>
      </span>
    </div>
  </div>

  <div class="totals-box-container">
    {% assign payment_config = current_school | has_feature: 'product_payment_config' %}
    {% if payment_option.kind == 'common' and payment_config == false  %}
    <div class="totals-box-item">
      {{ 'checkout.total_amount_to_pay_in_installments' | t: installments: installments_limit }}
    </div>
    <div class="totals-box-item">
      <span class="installment-price">
        <b id="js-payment-installments">
          {{ payment_option.total | number_with_taxes: gateway | divided_by: installments_limit | money }}
        </b>
      </span>
    </div>
    {% endif %}
  </div>
</section>

<style>
  #js-totals-box {
    padding: 20px 0;
  }

  .totals-box-container {
    display: flex;
    justify-content: space-between;
  }

  .totals-box-item {
    flex-wrap: wrap;
  }

  .product-value-text {
    font-size: 16px;
  }

  .divider {
    border-top: 1px solid #bbb;
  }

  .discount-text {
    color: #797979;
  }

  .installment-price {
    color: #0C3CF8;
  }

  #link-remove-coupon {
    color: #000;
  }
</style>

<script>
  let coupon = '{{ coupon }}';

  $('#js-input-coupon-container').hide();

  if (coupon.length === 0) {
    $('.js-remove-coupon-container').hide();
    $('#js-add-coupon-container').show();
  } else {
    $('.js-remove-coupon-container[style="display: none;"]').remove();
    $('.js-remove-coupon-container').show();
  }
</script>
